<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.2. Before Writing Code, Specify Its Required Behaviour</title>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="PHPSpec Reference Manual" />
    <link rel="up" href="writing.specs.with.phpspec.html" title="Chapter 5. Writing Specs with PHPSpec" />
    <link rel="prev" href="writing.specs.with.phpspec.html" title="Chapter 5. Writing Specs with PHPSpec" />
    <link rel="next" href="spec.domain.specific.language.html" title="5.3. The Spec Domain Specific Language (DSL)" />
    <link rel="preface" href="preface.html" title="Preface" />
    <link rel="chapter" href="installing.phpspec.html" title="Chapter 1. Installing PHPSpec" />
    <link rel="chapter" href="getting.started.html" title="Chapter 2. Getting Started" />
    <link rel="chapter" href="introduction.html" title="Chapter 3. Introduction" />
    <link rel="chapter" href="phpspecs.goals.html" title="Chapter 4. PHPSpec's Goals" />
    <link rel="chapter" href="writing.specs.with.phpspec.html" title="Chapter 5. Writing Specs with PHPSpec" />
    <link rel="chapter" href="execution.methods.for.phpspec.html" title="Chapter 6. Execution Methods for PHPSpec" />
    <link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information" />
    <link rel="index" href="the.index.html" title="Index" />
    <link rel="subsection" href="before.writing.code.specify.its.required.behaviour.html#explaining.the.phpspec.spec.layout" title="5.2.1. Explaining the PHPSpec Spec Layout" />
    <link rel="subsection" href="before.writing.code.specify.its.required.behaviour.html#the.code.to.implement.the.new.filesystem.logger.specification" title="5.2.2. The Code To Implement The New Filesystem Logger Specification" />
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">5.2. Before Writing Code, Specify Its Required Behaviour</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="writing.specs.with.phpspec.html">Prev</a> </td>
          <th width="60%" align="center">Chapter 5. Writing Specs with PHPSpec</th>
          <td width="20%" align="right"> <a accesskey="n" href="spec.domain.specific.language.html">Next</a></td>
        </tr>
      </table>
    </div>
    <div class="section" lang="en" xml:lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="before.writing.code.specify.its.required.behaviour"></a>5.2. Before Writing Code, Specify Its Required Behaviour</h2>
          </div>
        </div>
      </div>
      <p>In the course of developing a new application we've determined we
    need a Logging<a id="id570253" class="indexterm"></a> system, perhaps to store an audit trail. We're going to
    assume no current open source Logger library is sufficient for our needs
    and we are required to develop one from scratch. before we can do anything
    we need to start figuring out what it needs to do. In other words, how we
    want it to behave. After consulting with our colleagues we determine at
    least one fundamental requirement - to log messages to a
    filesystem.</p>
      <p>Rather than immediately jumping into an editor to start coding,
    we're going to write the specifications<a id="id569742" class="indexterm"></a> first.</p>
      <div class="example">
        <a id="id569655"></a>
        <p class="title">
          <b>Example 5.2. Some Plain Text Specs for a Filesystem Logger</b>
        </p>
        <div class="example-contents">
          <pre class="screen">New Filesystem Logger:
- should create a new log file if none currently exists
- should use an existing log file if one exists without truncating it
- should throw Exception if existing log file not writeable</pre>
        </div>
      </div>
      <br class="example-break" />
      <p>These simple plain text specifications can be translated to PHPSpec
    by creating a new Context class contain the examples demonstrating these
    behaviours.</p>
      <pre class="programlisting">class DescribeNewFilesystemLogger extends PHPSpec_Context
{

    public function itShouldCreateCreateNewLogFileIfNoneExists()
    {
        $this-&gt;pending();
    }

    public function itShouldUseAnExistingLogFileIfOneExistsWithoutTruncatingIt()
    {
        $this-&gt;pending();
    }

    public function itShouldThrowExceptionIfExistingLogFileNotWriteable()
    {
        $this-&gt;pending();
    }

}</pre>
      <p>This skeleton class has two Pending<a id="id569487" class="indexterm"></a> examples. The pending status simply means they are
    incomplete or pending completion. If you were to execute this spec from
    the command line when saved as NewFilesystemLoggerSpec.php (using the
    alternate filename convention which utilises a "Spec" suffix and omits the
    "Describe" prefix), the output would look something like:</p>
      <pre class="screen">PPP

Finished in 0.0468921661377 seconds

3 examples, 0 failures, 3 pending</pre>
      <p>The relevant command line target to run PHPSpec would be something
    like:</p>
      <pre class="screen">phpspec NewFileSystemLoggerSpec</pre>
      <p>We now have two example methods. Based on the defined
    specifications, let's fill these in with something useful.</p>
      <div class="example">
        <a id="id569217"></a>
        <p class="title">
          <b>Example 5.3. Specification for a New Filesystem Logger Context</b>
        </p>
        <div class="example-contents">
          <pre class="programlisting">class DescribeNewFilesystemLogger extends PHPSpec_Context
{

    public function itShouldCreateCreateNewLogFileIfNoneExists()
    {
        $file = $this-&gt;getTmpFileName();
        $logger = new Logger($file);
        $this-&gt;spec(file_exists($file))-&gt;should-&gt;beTrue();
    }

    public function itShouldUseAnExistingLogFileIfOneExistsWithoutTruncatingIt()
    {
        $file = $this-&gt;getTmpFileName();
        file_put_contents($file, 'Hello' . "\n");
        $logger = new Logger($file);
        $this-&gt;spec(file_get_contents($file))-&gt;shouldNot-&gt;beEmpty();
    }

    public function itShouldThrowExceptionIfExistingLogFileNotWriteable()
    {
        $file = $this-&gt;getTmpFileName();
        file_put_contents($file, 'Hello' . "\n");
        $this-&gt;spec('Logger', $file)-&gt;should-&gt;throw('Exception');
    }

    public function after()
    {
        unlink($this-&gt;getTmpFileName());
    }

    public function getTmpFileName()
    {
        return sys_get_temp_dir() . DIRECTORY_SEPARATOR . 'logger_tmp_file.log';
    }

}</pre>
        </div>
      </div>
      <br class="example-break" />
      <p>And so we've now turned our plain text specs into coded examples for
    execution. Of course executing this now will result in an ugly Fatal Error
    since the Logger class does not yet exist. We'll cross this bridge later
    on.</p>
      <div class="section" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="explaining.the.phpspec.spec.layout"></a>5.2.1. Explaining the PHPSpec Spec Layout</h3>
            </div>
          </div>
        </div>
        <p>Our completed New Filesystem Logger example demonstrates how a
      Spec<a id="id567010" class="indexterm"></a> is put together.</p>
        <div class="orderedlist">
          <ol type="1">
            <li>
              <p>All Specs are aggregated within a PHPSpec_Context subclass
          based on the condition of the system being specified</p>
            </li>
            <li>
              <p>All Context classnames must begin with the term "Describe" to
          encourage full sentence descriptions</p>
            </li>
            <li>
              <p>All Example methods in a Context must begin with "itShould",
          again to encourage full sentence specification text (this might be
          later shortened to optionally omit "Should" to allow present tense
          specification language)</p>
            </li>
            <li>
              <p>A <code class="classname">PHPSpec_Context::spec()</code> method is
          utilised to prepare any object or scalar value for expectations via
          the DSL.</p>
            </li>
            <li>
              <p>The domain specific langauge (DSL) generally includes an
          Expectation (should/shouldNot) and a Matcher (beSomething,
          haveSomething, equals, etc.)</p>
            </li>
            <li>
              <p>It is almost a rule that you only have one Spec per Example -
          this ensures each Spec is a single isolated piece of
          behaviour</p>
            </li>
            <li>
              <p>You can add any other methods to the class to provide Helper
          Methods, e.g. <code class="classname">getTmpFileName()</code></p>
            </li>
            <li>
              <p>You can use <code class="classname">after()</code> and
          <code class="classname">before()</code> methods to setup common Fixtures for
          each Example</p>
            </li>
            <li>
              <p>You can also use <code class="classname">afterAll()</code> and
          <code class="classname">beforeAll()</code> methods with are run only once
          before and after all Examples are executed</p>
            </li>
            <li>
              <p>Note that any Exceptions or Errors triggered with an Example
          will be reported but will not interrupt any other tests</p>
            </li>
          </ol>
        </div>
      </div>
      <div class="section" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="the.code.to.implement.the.new.filesystem.logger.specification"></a>5.2.2. The Code To Implement The New Filesystem Logger
      Specification</h3>
            </div>
          </div>
        </div>
        <p>With our specification now written up with PHPSpec, we can move on
      and implement the Logger to its specifications. I'm sure many people
      will note some paths for refactoring but for now we're only interested
      in writing the minimum amount of code necessary to pass all our
      Specs.</p>
        <div class="example">
          <a id="id572319"></a>
          <p class="title">
            <b>Example 5.4. Implementation of the Filesystem Logger</b>
          </p>
          <div class="example-contents">
            <pre class="programlisting">class Logger
{

    protected $_file = null;

    public function __construct($file)
    {
        if (!file_exists($file)) {
            $f = fopen($file, 'w');
            fclose($f);
        } elseif (file_exists($file) &amp;&amp; is_writeable($file)) {
            $this-&gt;_file = $file;
        } else {
            throw new Exception('log file is not writeable'); 
        }
    }

}</pre>
          </div>
        </div>
        <br class="example-break" />
        <p>The next step is deciding what the next behaviour should be so we
      can write a Spec for it. Maybe you want to add a Logger_Exception class
      to extend Exception? Maybe the file needs a few more checks? Maybe you
      want to consider moving file handling to a new subclass or strategy
      class for composition?</p>
        <p>Whatever you would decide - write a spec for it before adding more
      code. Take small steps and build up your classes iteratively. Remember
      also not to over-specify. Just because you extract file handling to a
      new class does not mean you should immediately specify the new class
      (unless it's valuable enough to warrant it) since the original Specs
      still cover the effects of a Logger being instantiated with a file. This
      is not adding new behaviour - it's just changing the implementation of
      that behaviour transparently.</p>
      </div>
    </div>
    <div class="navfooter">
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="writing.specs.with.phpspec.html">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="writing.specs.with.phpspec.html">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="spec.domain.specific.language.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 5. Writing Specs with PHPSpec </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> 5.3. The Spec Domain Specific Language (DSL)</td>
        </tr>
      </table>
    </div>
    <div xmlns="" class="revinfo"></div>
  </body>
</html>
